$(function(){window.app={};dataSection=$("#data-section");var e=getTransferData("user-id");var t=getTransferData("user-name");var n=0;if(e==undefined){e=0;t="遊客"}if("WebSocket"in window){var r=$("#chat-room").data("chatroom-url");app.BrainSocket=new BrainSocket(new WebSocket("ws://"+r+":27704"),new BrainSocketPubSub);app.BrainSocket.Event.listen("generic.event",function(e){s(e.client.data.user_name,e.client.data.message,"")});app.BrainSocket.Event.listen("generic.success",function(e){s("系統","連線成功","success")});app.BrainSocket.Event.listen("app.error",function(e){s("系統","連線失敗","error")});$("#chat-message").keypress(function(r){if(r.keyCode==13){if($.now()-n>=1e4){n=$.now();app.BrainSocket.message("generic.event",{message:$(this).val(),user_id:e,user_name:t});$(this).val("")}else{$.alertMessage("10秒只能發言一次噢=D",{type:"alert-warning"})}}return r.keyCode!=13});var i=false;$("#chat-room-button").click(function(){if(!i){$("#chat-room").animate({right:"0px"})}else{$("#chat-room").animate({right:"-230px"})}i=!i});function s(e,t,n){var r=$('<span class="chat-name"></span>').text(e+"：");var i=$('<span class="chat-message"></span>').text(t);var s=$('<div class="chat-row"></div>').append(r).append(i);$("#chat-log").append(s);$("#chat-log").scrollTop($("#chat-log").height()*2)}}else{$("#chat-room-button").click(function(){$.alertMessage("想聊天請使用更佳的瀏覽器",{type:"alert-warning"})})}})