function splitContent(e){var t=e.split("<br>");var n="<div class='subContent'>"+t[0]+"<br>"+t[1]+"<br>"+t[2]+"<br>"+t[3]+"<br>"+t[4]+"<br>"+t[5]+"<br>"+t[6]+"<br>"+t[7]+"<br>"+"</div>";return n}function countLines(e){return e.split("<br>").length}function showArticles(e,t,n,r,i,s,o,u,a){var f="";if(countLines(s)>10){f=splitContent(s)+"<div class='originContent'>"+s+"</div>						<span class='more'><a>觀看全文</a></span>"}else{f="<div class='subContent'>"+s+"</div>"}$(o).append("		<div class='articleContainer' id='"+r+"' >			<div class='postTimeContainer'>				<div class='articlePostTime'>					<span class='author'>"+e+"</span>發布於"+n+"				</div>			</div>			<div class='panel panel-default articleBody'>				<div class='panel-heading'>					<a href='"+perArticleUrl+"/"+r+"/"+u+"/"+a+"'><h3 class='panel-title'>"+i+"</h3></a>				</div>				<div class='personalImageBox' >					<img class='personalImage' src='"+burl+"/person/"+t+"'>				</div>				<div class='panel-body content'>"+f+"</div>				<div class='clear'></div>			</div>		</div>");$(".more").click(function(e){e.preventDefault();$(this).parent().parent().find(".subContent").remove();$(this).parent().parent().find(".originContent").fadeIn("fast");$(this).remove()})}function insertArticle(e,t,n,r,i,s,o){var u="";if(countLines(s)>10){u=splitContent(s)+"<div class='originContent'>"+s+"</div>						<span class='more'><a>觀看全文</a></span>"}else{u="<div class='subContent'>"+s+"</div>"}if(o=="#toolBar"){$(o).after("			<div class='articleContainer' id='"+r+"' >				<div class='postTimeContainer'>					<div class='articlePostTime'>						<span class='author'>"+e+"</span>發布於"+n+"					</div>				</div>				<div class='panel panel-default articleBody'>					<div class='panel-heading forumTitleBox'>						<a href='"+perArticleUrl+"/"+r+"'><h3 class='panel-title'>"+i+"</h3></a>					</div>					<div class='personalImageBox' >						<img class='personalImage' src='"+burl+"/person/"+t+"'>					</div>					<div class='panel-body content'>"+u+"</div>					<div class='clear'></div>				</div>			</div>")}else{$(o).append("			<div class='articleContainer' id='"+r+"' >				<div class='postTimeContainer'>					<div class='articlePostTime'>						<span class='author'>"+e+"</span>發布於"+n+"					</div>				</div>				<div class='panel panel-default articleBody'>					<div class='panel-heading forumTitleBox'>						<a href='"+perArticleUrl+"/"+r+"'><h3 class='panel-title'>"+i+"</h3></a>					</div>					<div class='personalImageBox' >						<img class='personalImage' src='"+burl+"/person/"+t+"'>					</div>					<div class='panel-body content'>"+u+"</div>					<div class='clear'></div>				</div>			</div>")}$(".more").click(function(e){e.preventDefault();$(this).parent().parent().find(".subContent").remove();$(this).parent().parent().find(".originContent").fadeIn("fast");$(this).remove()})}function getArticles(e,t,n){$.ajax({type:"POST",url:getArticlesUrl+"?page="+t,data:{articleType:e},success:function(r){for(i=0;i<r["data"].length;i++){showArticles(r["data"][i]["user"]["name"],r["data"][i]["author_id"],r["data"][i]["created_at"],r["data"][i]["id"],r["data"][i]["title"],r["data"][i]["content"].replace(/\n/g,"<br>"),n,e,t)}pageGenerate(pageLocation,r.last_page);if(e=="new"||e=="pop"){$("#Test1 .panel-heading").each(function(){$(this).addClass("forumTitleBox")})}else if(e=="department"){$("#Test2 .panel-heading").each(function(){$(this).addClass("departmentTitleBox")})}else if(e=="club"){$("#Test3 .panel-heading").each(function(){$(this).addClass("clubTitleBox")})}}},"json")}function pageGenerate(e,t){var n="";if(t<=9){for(i=0;i<t;i++){if(i+1==e){n=n+"<li class='active p' id='"+(i+1)+"'><a class='page'>"+(i+1)+"</a></li>"}else{n=n+"<li class='disable p' id='"+(i+1)+"'><a class='page'>"+(i+1)+"</a></li>"}}}else{if(e<=5){for(i=0;i<9;i++){if(i+1==e){n=n+"<li class='active p' id='"+(i+1)+"'><a class='page'>"+(i+1)+"</a></li>"}else{n=n+"<li class='disable p' id='"+(i+1)+"'><a class='page'>"+(i+1)+"</a></li>"}}}else if(e>=t-4){for(i=0;i<9;i++){if(t-8+i==e){n=n+"<li class='active p' id='"+(t-8+i)+"'><a class='page'>"+(t-8+i)+"</a></li>"}else{n=n+"<li class='disable p' id='"+(t-8+i)+"'><a class='page'>"+(t-8+i)+"</a></li>"}}}else{for(i=0;i<9;i++){if(e-4+i==e){n=n+"<li class='active p' id='"+(e-4+i)+"'><a class='page'>"+(e-4+i)+"</a></li>"}else{n=n+"<li class='disable p' id='"+(e-4+i)+"'><a class='page'>"+(e-4+i)+"</a></li>"}}}}if(e==t){n="<li><a id='previousPage'>&laquo;</a></li>"+n}else{n="<li><a id='previousPage'>&laquo;</a></li>"+n+"<li><a id='nextPage'>&raquo;</a></li>"}$(".pagination").html(n);if(first){$("li.active.p").removeClass("active");$("li[id = "+initPage+"]").addClass("active");first=false}$(".page").click(function(e){e.preventDefault();pageLocation=$(this).html();switch(tabLocation){case"new":$("#Test1 .articleContainer").remove();getArticles(tabLocation,pageLocation,"#Test1");break;case"pop":$("#Test1 .articleContainer").remove();getArticles(tabLocation,pageLocation,"#Test1");break;case"department":$("#Test2 .articleContainer").each(function(){$(this).remove()});getArticles(tabLocation,pageLocation,"#Test2");break;case"club":$("#Test3 .articleContainer").each(function(){$(this).remove()});getArticles(tabLocation,pageLocation,"#Test3");break}})}function bonusStart(){function a(){dimension=n.getBoundingClientRect();positionLeft=dimension.left;positionTop=dimension.top;if(positionLeft<=0||positionLeft+r>=t){o=o*-1;$("#myTab , #freshButton, #createBtn , .articleContainer , #orderBox , #chat-room-button , #topContent").effect("shake",{times:.5,direction:"left",distance:20},100)}if(positionTop<=0||positionTop+i>=e){u=u*-1;$("#myTab , #freshButton, #createBtn , .articleContainer, #orderBox , #chat-room-button , #topContent").effect("shake",{times:.5,direction:"up",distance:20},100)}positionLeft+=o/s;positionTop+=u/s;n.style.left=positionLeft+"px";n.style.top=positionTop+"px"}var e=document.documentElement.clientHeight;var t=document.documentElement.clientWidth;var n=document.getElementById("scrollTop");var r=$("#scrollTop").width();var i=$("#scrollTop").height();var s=10;var o=-200;var u=-200;origin=n.getBoundingClientRect();originLeft=origin.left;originTop=origin.top;$("#globalContainer").append("<button type='button' class='btn btn-primary' id='stop'>Stop</button>");var f=setInterval(a,s);$("#stop").click(function(){$(this).remove();clearInterval(f);n.style.left=originLeft+"px";n.style.top=originTop+"px"})}var titleEmptyMsg="文章標題";var contentEmptyMsg="文章內容";var commentEmptyMsg="留言內容";var notLoginMsg="您尚未登入會員哦！";var newArticleUrl;var perArticleUrl;var getArticlesUrl;var loginStatus;var userId;var userName;var tabLocation="new";var pageLocation=1;var burl="";var initType="";var initPage="";var initTab="#Test1";var first=true;$(function(){burl=getTransferData("burl");loginStatus=$("#data_section").attr("data-login");if(loginStatus==1){userId=$("#data_section").attr("data-user-id");userName=$("#data_section").attr("data-user-name")}newArticleUrl=$("#newArticle").attr("direct");perArticleUrl=$("#perArticle").attr("direct");getArticlesUrl=$("#getArticles").attr("direct");initType=$("#initType").attr("direct");initPage=$("#initPage").attr("direct");if(initType=="new"){$("#articleTab").parent().addClass("active");initTab="#Test1"}else if(initType=="pop"){$("#articleTab").parent().addClass("active");var e=document.getElementById("pop");e.checked=true;initTab="#Test1"}else if(initType=="department"){$("#departmentTab").parent().addClass("active");initTab="#Test2";$("#Test1").css("display","none")}else if(initType=="club"){$("#clubTab").parent().addClass("active");initTab="#Test3";$("#Test1").css("display","none")}$(initTab).css("display","block");getArticles(initType,initPage,initTab);$("#articleTab").click(function(e){e.preventDefault();$("#Test1").css("display","block");tabLocation="new";pageLocation=1;$("#Test1 .articleContainer").remove();$.pushLocation("","/articles/"+tabLocation+"/"+pageLocation,{full:false});getArticles(tabLocation,pageLocation,"#Test1");$("#Test2 .articleContainer").each(function(){$(this).remove()});$("#Test2").css("display","none");$("#Test3 .articleContainer").each(function(){$(this).remove()});$("#Test3").css("display","none");$(this).tab("show")});$("#new").change(function(){tabLocation="new";pageLocation=1;$("#Test1 .articleContainer").remove();$.pushLocation("","/articles/"+tabLocation+"/"+pageLocation,{full:false});getArticles(tabLocation,pageLocation,"#Test1")});$("#pop").change(function(){tabLocation="pop";pageLocation=1;$("#Test1 .articleContainer").remove();$.pushLocation("","/articles/"+tabLocation+"/"+pageLocation,{full:false});getArticles(tabLocation,pageLocation,"#Test1")});$("#clubTab").click(function(e){if(tabLocation!="club"){$("#Test3").css("display","block");$("#Test3 .articleContainer").each(function(){$(this).remove()});tabLocation="club";pageLocation=1;e.preventDefault();$(this).tab("show");$("#Test2 .articleContainer").each(function(){$(this).remove()});$("#Test1").css("display","none");$("#Test2").css("display","none");$.pushLocation("","/articles/"+tabLocation+"/"+pageLocation,{full:false});getArticles(tabLocation,pageLocation,"#Test3")}});$("#departmentTab").click(function(e){if(tabLocation!="department"){$("#Test2").css("display","block");$("#Test2 .articleContainer").each(function(){$(this).remove()});tabLocation="department";pageLocation=1;e.preventDefault();$(this).tab("show");$("#Test3 .articleContainer").each(function(){$(this).remove()});$("#Test1").css("display","none");$("#Test3").css("display","none");$.pushLocation("","/articles/"+tabLocation+"/"+pageLocation,{full:false});getArticles(tabLocation,pageLocation,"#Test2")}});$(document).on("click","#previousPage",function(e){e.preventDefault();if(pageLocation==1){$("#bonusMsgDialog").modal("toggle")}else{pageLocation--;switch(tabLocation){case"new":$("#Test1 .articleContainer").remove();getArticles(tabLocation,pageLocation,"#Test1");break;case"pop":$("#Test1 .articleContainer").remove();getArticles(tabLocation,pageLocation,"#Test1");break;case"department":$("#Test2 .articleContainer").each(function(){$(this).remove()});getArticles(tabLocation,pageLocation,"#Test2");break;case"club":$("#Test3 .articleContainer").each(function(){$(this).remove()});getArticles(tabLocation,pageLocation,"#Test3");break}$.pushLocation("","/articles/"+tabLocation+"/"+pageLocation,{full:false})}});$(document).on("click","#nextPage",function(e){e.preventDefault();pageLocation++;switch(tabLocation){case"new":$("#Test1 .articleContainer").remove();getArticles(tabLocation,pageLocation,"#Test1");break;case"pop":$("#Test1 .articleContainer").remove();getArticles(tabLocation,pageLocation,"#Test1");break;case"department":$("#Test2 .articleContainer").each(function(){$(this).remove()});getArticles(tabLocation,pageLocation,"#Test2");break;case"club":$("#Test3 .articleContainer").each(function(){$(this).remove()});getArticles(tabLocation,pageLocation,"#Test3");break}$.pushLocation("","/articles/"+tabLocation+"/"+pageLocation,{full:false})});$("#createBtn").click(function(){if(loginStatus!=1){$("#errorMsgContent").text(notLoginMsg);$("#errorMsgDialog").modal("toggle")}if(loginStatus==1){$("#myModal").modal("toggle")}});$("#submitArticle").click(function(){var e=$("#inputTitle").val();var t=$("#inputDetail").val();var n=$("#selectType").val();if(e==""&&t==""){$("#errorMsgContent").text("請輸入"+titleEmptyMsg+" , "+contentEmptyMsg);$("#errorMsgDialog").modal("toggle")}else if(e==""&&t!=""){$("#errorMsgContent").text("請輸入"+titleEmptyMsg);$("#errorMsgDialog").modal("toggle")}else if(e!=""&&t==""){$("#errorMsgContent").text("請輸入"+contentEmptyMsg);$("#errorMsgDialog").modal("toggle")}else if(e.length>=20){$("#errorMsgContent").text("標題長度上限為20字哦!");$("#errorMsgDialog").modal("toggle")}else if(t.length>=500){$("#errorMsgContent").text("文章長度上限為500字哦!");$("#errorMsgDialog").modal("toggle")}else{$.ajax({type:"POST",url:newArticleUrl,data:{title:e,content:t,article_type:n},success:function(e){if(e.washing==true){$("#errorMsgContent").text("您的發文時間間隔太短啦!");$("#errorMsgDialog").modal("toggle")}else{$("#inputTitle").val("");$("#inputAuthor_id").val("");$("#inputDetail").val("");$("#myModal").modal("toggle");var t;if(n=="P"){t="#toolBar"}else if(n=="D"){t="#Test2"}else if(n=="C"){t="#Test3"}var r=new Date(e.articleTime.date);if(isNaN(r.getFullYear())){var i=e.articleTime.date}else{var i=r.getFullYear()+"-"+(r.getMonth()+1)+"-"+r.getDate()+" "+r.getHours()+":"+r.getMinutes()+":"+r.getSeconds()}insertArticle(e.articleAuthor,e.authorId,i,e.articleId,e.articleTitle,e.articleContent.replace(/\n/g,"<br>"),t)}},error:function(){alert("Error")}},"json")}});$("#scrollTop").click(function(){$("body").animate({scrollTop:0},"slow")});$("#start").click(function(){bonusStart()})})